<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1">
  <title>Layers finished updating</title>
  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }

    .console>span {
      color: #42f4d9;
    }
  </style>
   <link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
  <link rel="stylesheet" href="https://js.arcgis.com/4.11/esri/css/main.css">
  <link rel="stylesheet" href="../style.css">
  <script src="https://js.arcgis.com/4.11/"></script>
  <script>
    require([
      "esri/WebScene",
      "esri/views/SceneView",
      "esri/core/watchUtils"
    ], function(WebScene, SceneView, watchUtils) {

      // Create Map
      const webscene = new WebScene({
        portalItem: {
          id: "42520910351f44ddb9145302617d8915"
        }
      });

      // Create the SceneView
      const view = new SceneView({
        container: "viewDiv",
        map: webscene
      });

      const statusContainer = document.getElementById("status");

      let updatedLayers = 0;

      view.when(function() {
        view.map.allLayers.forEach(function(layer) {
          view.whenLayerView(layer)
            .then( function(layerView) {
              watchUtils.whenFalseOnce(layerView, "updating", function(value) {
                statusContainer.innerHTML += `<br>Layer <span>${layer.title}</span> finished updating.`
                updatedLayers += 1;
                if (updatedLayers === view.map.allLayers.length) {
                  statusContainer.innerHTML += "<br>All layers finished updating";
                }
              });
            });
        });
      });
    view.ui.add(statusContainer, "bottom-left");
    window.view = view;
  });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
  <div id="status" class="console"></div>
</body>

</html>
